@layout("/common/_container.html"){
<!--<div class="chat-content" id="chat-box"></div>-->
<!--<form onsubmit="return false;">
    <div class="input-box">
        <input type="hidden" id="username" value="${shiro.getUser().name}">
        <input type="text" id="message" placeholder="请输入消息" autocomplete="off"
               onkeydown="if(event.keyCode==13){send();}">
        <input type="submit" value="发送" onclick="send()">
    </div>
</form>-->
<div id="articleContainer">
		<textarea class="editormd-markdown-textarea" name="markdownText" id="origin">
			### 关于 Editor.md**Editor.md** 是一款开源的、可嵌入的 Markdown 在线编辑器（组件），基于 CodeMirror、jQuery 和 Marked 构建。
		</textarea>
    <textarea class="editormd-html-textarea" name="htmlText" id="message"></textarea>
</div>
<div >
    <button id="mybtn">获取</button>
</div>
<script>

    $(function() {
        var editor = editormd("articleContainer", {
            width  : "100%",
            height : "500",//不能使用百分比，使用后，将根据内容自动收放
            watch  : false,//是否开启预览
            markdown: "",//markdown文本内容
            saveHTMLToTextarea: true,    // 是否将文本保存 HTML 到 Textarea
            path   : "static/editormd/lib/"//lib的路径
            /*//下面三个属性，当文章需要包含图片时添加
            imageUpload : true,//是否开启图片自动上传
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],//可上传的图片格式
            imageUploadURL : "网络地址/项目名/上传路径"//图片上传地址，如: http:localhost:8080/mylove/imageUpload.do
            */
        });
        //由于editot.md是懒加载
        setTimeout(function(){
            //获取编辑器内容
            console.log(editor.getMarkdown());
        },500);

        //绑定点击事件
        $("#mybtn").click(function(){
            //这里没有去写后端接口了，将内容存至浏览器存储以便查看和编辑
            window.localStorage.setItem("data",JSON.stringify(editor.getMarkdown()));
        });
    });

    var ws = new WebSocket("ws://" + window.location.host + "/websocket");

    ws.onopen = function (event) {
        console.log("WebSocket connected.");
        ws.send("Hello, WebSocket!");
    };

    ws.onmessage = function (event) {
        console.log("WebSocket message received: " + event.data);
        var message = JSON.parse(event.data);
        var chatBox = $("#chat-box");
        chatBox.append("<p>" + message.username + ": " + message.content + "</p>");
    };

    ws.onclose = function (event) {
        console.log("WebSocket closed.");
    };

    ws.onerror = function (event) {
        console.log("WebSocket error: " + event.data);
    };

    function send() {
        var message = $("#message").val();
        var username = $("#username").val();
        var data = {
            "username": username,
            "content": message
        };
        ws.send(JSON.stringify(data));
        $("#message").val("");
    }
</script>
@}